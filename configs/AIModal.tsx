const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const apiKey = process.env.EXPO_PUBLIC_GOOGLE_GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [
        {
          text: 'Generate a 3 Day, 2 Night travel plan JSON for a couple with a moderate budget in Da Nang, Vietnam, strictly following this structure: { "tripDetails": { "budget", "duration", "location", "travelers" }, "flightDetails": { "arrivalCity", "estimatedFlightPrice": { "amount",  "currency" }, "exampleBookingUrl" }, "hotelOptions": [{ "hotelName", "hotelAddress", "price": { "currency", "perNight" }, "hotelImageUrl", "geoCoordinates": { "latitude", "longitude" }, "rating", "description", "amenities": [] }], "dayPlans": [{ "day", "activities": [{ "placeName", "placeDetails", "placeImageUrl", "geoCoordinates": { "latitude", "longitude" }, "ticketPricing": { "amount", "currency" }, "timeToTravel", "bestTimeToVisit" }] }], "foodRecommendations": [], "notes": [] }, where "placeName" is a real location verifiable on Google Maps for accurate "geoCoordinates", using placeholder URLs/dates/prices, and outputting ONLY the JSON block.',
        },
      ],
    },
    {
      role: "model",
      parts: [{ text: "```json\n{\n  \"tripDetails\": {\n    \"budget\": \"Moderate\",\n    \"duration\": \"3 Days, 2 Nights\",\n    \"location\": \"Da Nang, Vietnam\",\n    \"travelers\": \"Couple\"\n  },\n  \"flightDetails\": {\n    \"arrivalCity\": \"Da Nang (DAD)\",\n    \"estimatedFlightPrice\": {\n      \"amount\": 600,\n      \"currency\": \"USD\"\n    },\n    \"exampleBookingUrl\": \"https://www.exampleflightbooking.com/danang\"\n  },\n  \"hotelOptions\": [\n    {\n      \"hotelName\": \"Grand Tourane Hotel Da Nang\",\n      \"hotelAddress\": \"252 Vo Nguyen Giap, My An, Ngu Hanh Son, Da Nang, Vietnam\",\n      \"price\": {\n        \"currency\": \"USD\",\n        \"perNight\": 75\n      },\n      \"hotelImageUrl\": \"https://www.examplehotelimages.com/grandtourane.jpg\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.035382,\n        \"longitude\": 108.248105\n      },\n      \"rating\": 4.5,\n      \"description\": \"Located right on My Khe Beach, offering stunning ocean views and modern amenities.\",\n      \"amenities\": [\n        \"Swimming Pool\",\n        \"Spa\",\n        \"Restaurant\",\n        \"Beach Access\",\n        \"Free WiFi\"\n      ]\n    },\n    {\n      \"hotelName\": \"Cicilia Hotel & Spa Da Nang\",\n      \"hotelAddress\": \"6-8-10 Do Ba, My An, Ngu Hanh Son, Da Nang, Vietnam\",\n      \"price\": {\n        \"currency\": \"USD\",\n        \"perNight\": 60\n      },\n      \"hotelImageUrl\": \"https://www.examplehotelimages.com/cicilia.jpg\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.034233,\n        \"longitude\": 108.247587\n      },\n      \"rating\": 4.2,\n      \"description\": \"A comfortable hotel with spa services and a convenient location near the beach.\",\n      \"amenities\": [\n        \"Spa\",\n        \"Restaurant\",\n        \"Rooftop Pool\",\n        \"Free WiFi\",\n        \"Fitness Center\"\n      ]\n    }\n  ],\n  \"dayPlans\": [\n    {\n      \"day\": 1,\n      \"activities\": [\n        {\n          \"placeName\": \"My Khe Beach\",\n          \"placeDetails\": \"Famous for its soft white sand and clear blue water. Ideal for swimming and sunbathing.\",\n          \"placeImageUrl\": \"https://www.exampleplacimages.com/mykhe.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 16.053593,\n            \"longitude\": 108.244811\n          },\n          \"ticketPricing\": {\n            \"amount\": 0,\n            \"currency\": \"USD\"\n          },\n          \"timeToTravel\": \"N/A - On site\",\n          \"bestTimeToVisit\": \"Morning or late afternoon\"\n        },\\n        {\n          \"placeName\": \"Dragon Bridge\",\n          \"placeDetails\": \"Iconic bridge that breathes fire and water on weekend nights. A must-see spectacle.\",\n          \"placeImageUrl\": \"https://www.exampleplacimages.com/dragonbridge.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 16.062938,\n            \"longitude\": 108.227101\n          },\n          \"ticketPricing\": {\n            \"amount\": 0,\n            \"currency\": \"USD\"\n          },\n          \"timeToTravel\": \"10 minutes by taxi from My Khe Beach\",\n          \"bestTimeToVisit\": \"Saturday or Sunday evening (9 PM for fire/water show)\"\n        }\n      ]\n    },\n    {\n      \"day\": 2,\n      \"activities\": [\n        {\n          \"placeName\": \"Ba Na Hills\",\n          \"placeDetails\": \"A mountain resort with stunning views, the Golden Bridge, and a French village.\",\n          \"placeImageUrl\": \"https://www.exampleplacimages.com/banahills.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 16.009222,\n            \"longitude\": 108.057417\n          },\n          \"ticketPricing\": {\n            \"amount\": 35,\n            \"currency\": \"USD\"\n          },\n          \"timeToTravel\": \"1 hour by taxi or shuttle from Da Nang\",\n          \"bestTimeToVisit\": \"Early morning to avoid crowds\"\n        }\n      ]\n    },\n    {\n      \"day\": 3,\n      \"activities\": [\n        {\n          \"placeName\": \"Marble Mountains\",\n          \"placeDetails\": \"A cluster of five limestone hills with caves, temples, and panoramic views.\",\n          \"placeImageUrl\": \"https://www.exampleplacimages.com/marblemountain.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 16.002327,\n            \"longitude\": 108.248933\n          },\n          \"ticketPricing\": {\n            \"amount\": 2,\n            \"currency\": \"USD\"\n          },\n          \"timeToTravel\": \"20 minutes by taxi from My Khe Beach\",\n          \"bestTimeToVisit\": \"Morning or late afternoon to avoid the heat\"\n        },\n        {\n            \"placeName\": \"Han Market\",\n            \"placeDetails\": \"A bustling local market with souvenirs, clothing, and fresh produce.\",\n            \"placeImageUrl\": \"https://www.exampleplacimages.com/hanmarket.jpg\",\n            \"geoCoordinates\": {\n              \"latitude\": 16.065549,\n              \"longitude\": 108.221178\n            },\n            \"ticketPricing\": {\n              \"amount\": 0,\n              \"currency\": \"USD\"\n            },\n            \"timeToTravel\": \"15 minutes by taxi from Marble Mountains\",\n            \"bestTimeToVisit\": \"Morning for the freshest selection\"\n          }\n      ]\n    }\n  ],\n  \"foodRecommendations\": [\n    {\n      \"restaurantName\": \"Banh Mi Phuong\",\n      \"foodType\": \"Banh Mi (Vietnamese Sandwich)\",\n      \"priceRange\": \"$\",\n      \"notes\": \"Highly recommended by Anthony Bourdain. Expect a queue.\"\n    },\n    {\n      \"restaurantName\": \"Com Ga Ba Buoi\",\n      \"foodType\": \"Com Ga (Chicken Rice)\",\n      \"priceRange\": \"$\",\n      \"notes\": \"Local favorite for delicious and affordable chicken rice.\"\n    },\n        {\n          \"restaurantName\": \"Madam Lan Restaurant\",\n          \"foodType\": \"Vietnamese\",\n          \"priceRange\": \"$$\",\n          \"notes\": \"Great for a variety of traditional Vietnamese dishes.\"\n        }\n  ],\n  \"notes\": [\n    \"Remember to bargain when shopping at the markets.\",\n    \"Wear comfortable shoes as you'll be doing a lot of walking.\",\n    \"Stay hydrated and use sunscreen, especially during the day.\",\n    \"Learn a few basic Vietnamese phrases to enhance your experience.\",\n    \"Consider downloading a translation app.\"\n  ]\n}\n```\n\n" }],
    },
  ],
});
